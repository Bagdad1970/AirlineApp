<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ê–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞–º–∏ –∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f8fafc;
      color: #1e293b;
      line-height: 1.5;
      padding: 20px;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
    }
    h1 { font-size: 2rem; color: #0f172a; }
    .subtitle { color: #64748b; margin-top: 8px; }

    .tabs {
      display: flex;
      gap: 1px;
      background: #e2e8f0;
      border-radius: 8px;
      overflow: hidden;
      max-width: 600px;
      margin: 0 auto 24px;
    }
    .tab {
      flex: 1;
      padding: 14px;
      text-align: center;
      background: white;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s;
    }
    .tab.active {
      background: #3b82f6;
      color: white;
    }

    .section { display: none; }
    .section.active { display: block; }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      padding: 20px;
      margin-bottom: 20px;
    }
    .card h2 {
      color: #334155;
      margin-bottom: 16px;
      font-size: 1.3rem;
      border-bottom: 1px solid #e2e8f0;
      padding-bottom: 8px;
    }

    .form-group {
      margin-bottom: 16px;
    }
    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #475569;
    }
    input, select, button, textarea {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #cbd5e1;
      border-radius: 6px;
      font-size: 15px;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
    }
    button {
      background: #3b82f6;
      color: white;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover:not(:disabled) { background: #2563eb; }
    button:disabled { opacity: 0.6; cursor: not-allowed; }

    .response {
      margin-top: 20px;
      padding: 14px;
      background: #f1f5f9;
      border-radius: 6px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 300px;
      overflow: auto;
    }

    .list {
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      overflow: hidden;
    }
    .list-header {
      background: #f1f5f9;
      padding: 12px 16px;
      font-weight: 600;
      color: #334155;
    }
    .list-body {
      max-height: 400px;
      overflow-y: auto;
    }
    .list-item {
      padding: 12px 16px;
      border-bottom: 1px solid #e2e8f0;
      font-size: 0.95rem;
    }
    .list-item:last-child { border: none; }

    .error { color: #ef4444; }
    .success { color: #10b981; }

    footer {
      text-align: center;
      margin-top: 30px;
      color: #94a3b8;
      font-size: 0.85rem;
    }
  </style>
</head>
<body>

<header>
  <h1>‚úàÔ∏è –ê–≤–∏–∞–∫–æ–º–ø–∞–Ω–∏—è</h1>
  <p class="subtitle">Flight Management (8081) ‚Ä¢ Ticket Booking (8080)</p>
</header>

<div class="tabs">
  <div class="tab active" data-tab="flights">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Å–∞–º–∏</div>
  <div class="tab" data-tab="bookings">–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
</div>

<!-- ‚úàÔ∏è FLIGHTS SECTION -->
<div id="flights" class="section active">
  <!-- CREATE -->
  <div class="card">
    <h2>üÜï –°–æ–∑–¥–∞—Ç—å —Ä–µ–π—Å</h2>
    <form id="createForm">
      <div class="form-group">
        <label>–ù–æ–º–µ—Ä —Ä–µ–π—Å–∞</label>
        <input name="number" required placeholder="SU123" />
      </div>
      <div class="form-group">
        <label>–ì–æ—Ä–æ–¥ –≤—ã–ª–µ—Ç–∞</label>
        <input name="fromCity" required placeholder="–ú–æ—Å–∫–≤–∞" />
      </div>
      <div class="form-group">
        <label>–ì–æ—Ä–æ–¥ –ø—Ä–∏–ª—ë—Ç–∞</label>
        <input name="toCity" required placeholder="–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥" />
      </div>
      <div class="form-group">
        <label>–í—ã–ª–µ—Ç (ISO 8601, –Ω–∞–ø—Ä–∏–º–µ—Ä: 2025-12-21T08:00:00+03:00)</label>
        <input name="departure" type="text" required placeholder="2025-12-21T08:00:00+03:00" />
      </div>
      <div class="form-group">
        <label>–ü—Ä–∏–ª—ë—Ç (ISO 8601)</label>
        <input name="arrival" type="text" required placeholder="2025-12-21T09:30:00+03:00" />
      </div>
      <div class="form-group">
        <label>–ú–µ—Å—Ç (passengerCount)</label>
        <input name="passengerCount" type="number" min="0" required value="180" />
      </div>
      <div class="form-group">
        <label>–¶–µ–Ω–∞ –±–∏–ª–µ—Ç–∞</label>
        <input name="ticketPrice" type="number" step="0.01" min="0" required value="5000.00" />
      </div>
      <button type="submit">–°–æ–∑–¥–∞—Ç—å —Ä–µ–π—Å</button>
    </form>
    <div id="createResponse" class="response" style="display:none;"></div>
  </div>

  <!-- UPDATE -->
  <div class="card">
    <h2>‚úèÔ∏è –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Å</h2>
    <form id="updateForm">
      <div class="form-group">
        <label>ID —Ä–µ–π—Å–∞</label>
        <input name="id" type="number" required />
      </div>
      <div class="form-group">
        <label>–ù–æ–º–µ—Ä —Ä–µ–π—Å–∞</label>
        <input name="number" required />
      </div>
      <div class="form-group">
        <label>–ì–æ—Ä–æ–¥ –≤—ã–ª–µ—Ç–∞</label>
        <input name="fromCity" required />
      </div>
      <div class="form-group">
        <label>–ì–æ—Ä–æ–¥ –ø—Ä–∏–ª—ë—Ç–∞</label>
        <input name="toCity" required />
      </div>
      <div class="form-group">
        <label>–í—ã–ª–µ—Ç (ISO 8601)</label>
        <input name="departure" type="text" required />
      </div>
      <div class="form-group">
        <label>–ü—Ä–∏–ª—ë—Ç (ISO 8601)</label>
        <input name="arrival" type="text" required />
      </div>
      <div class="form-group">
        <label>–ú–µ—Å—Ç</label>
        <input name="passengerCount" type="number" min="0" required />
      </div>
      <div class="form-group">
        <label>–¶–µ–Ω–∞ –±–∏–ª–µ—Ç–∞</label>
        <input name="ticketPrice" type="number" step="0.01" min="0" required />
      </div>
      <button type="submit">–û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Å</button>
    </form>
    <div id="updateResponse" class="response" style="display:none;"></div>
  </div>

  <!-- DELETE -->
  <div class="card">
    <h2>üóë –£–¥–∞–ª–∏—Ç—å —Ä–µ–π—Å</h2>
    <form id="deleteForm">
      <div class="form-group">
        <label>ID —Ä–µ–π—Å–∞</label>
        <input name="id" type="number" required />
      </div>
      <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
    </form>
    <div id="deleteResponse" class="response" style="display:none;"></div>
  </div>

  <!-- QUERY (by fields) -->
  <div class="card">
    <h2>üîç –ó–∞–ø—Ä–æ—Å —Ä–µ–π—Å–æ–≤</h2>
    <form id="queryForm">
      <div class="form-group">
        <label>–ù–æ–º–µ—Ä —Ä–µ–π—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
        <input name="number" />
      </div>
      <div class="form-group">
        <label>–ì–æ—Ä–æ–¥ –≤—ã–ª–µ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
        <input name="fromCity" />
      </div>
      <div class="form-group">
        <label>–ì–æ—Ä–æ–¥ –ø—Ä–∏–ª—ë—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
        <input name="toCity" />
      </div>
      <button type="submit">–ù–∞–π—Ç–∏ —Ä–µ–π—Å—ã</button>
    </form>
    <div id="queryResponse" class="response" style="display:none;"></div>
  </div>

  <!-- LIST ALL -->
  <div class="card">
    <h2>üìã –í—Å–µ —Ä–µ–π—Å—ã</h2>
    <button id="listFlightsBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
    <div id="listFlightsResponse" class="response" style="display:none;"></div>
  </div>

  <!-- IMPORT / EXPORT -->
  <div class="card">
    <h2>üì• –≠–∫—Å–ø–æ—Ä—Ç / –ò–º–ø–æ—Ä—Ç CSV</h2>
    <div style="display:flex; gap:10px; flex-wrap:wrap;">
      <a href="http://localhost:8081/api/flight/export-csv" target="_blank">
        <button type="button">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å flights.csv</button>
      </a>
      <form id="importForm" style="flex:1; min-width:250px;">
        <div class="form-group">
          <label>–ó–∞–≥—Ä—É–∑–∏—Ç—å CSV</label>
          <input type="file" id="csvFile" accept=".csv" required />
        </div>
        <button type="submit">üì§ –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤ –ë–î</button>
      </form>
    </div>
    <div id="importResponse" class="response" style="display:none;"></div>
  </div>
</div>

<!-- üé´ BOOKINGS SECTION -->
<div id="bookings" class="section">
  <!-- CREATE BOOKING -->
  <div class="card">
    <h2>üéü –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω—å</h2>
    <form id="bookingCreateForm">
      <div class="form-group">
        <label>ID —Ä–µ–π—Å–∞</label>
        <input name="flightId" type="number" required />
      </div>
      <div class="form-group">
        <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤</label>
        <input name="passengerCount" type="number" min="1" required value="1" />
      </div>
      <button type="submit">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
    </form>
    <div id="bookingCreateResponse" class="response" style="display:none;"></div>
  </div>

  <!-- UPDATE BOOKING -->
  <div class="card">
    <h2>‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å</h2>
    <form id="bookingUpdateForm">
      <div class="form-group">
        <label>ID –±—Ä–æ–Ω–∏</label>
        <input name="id" type="number" required />
      </div>
      <div class="form-group">
        <label>–ù–æ–≤–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Å—Å–∞–∂–∏—Ä–æ–≤</label>
        <input name="passengerCount" type="number" min="1" required />
      </div>
      <button type="submit">–û–±–Ω–æ–≤–∏—Ç—å</button>
    </form>
    <div id="bookingUpdateResponse" class="response" style="display:none;"></div>
  </div>

  <!-- CANCEL BOOKING -->
  <div class="card">
    <h2>‚ùå –û—Ç–º–µ–Ω–∏—Ç—å –±—Ä–æ–Ω—å</h2>
    <form id="bookingDeleteForm">
      <div class="form-group">
        <label>ID –±—Ä–æ–Ω–∏</label>
        <input name="id" type="number" required />
      </div>
      <button type="submit">–û—Ç–º–µ–Ω–∏—Ç—å</button>
    </form>
    <div id="bookingDeleteResponse" class="response" style="display:none;"></div>
  </div>

  <!-- LIST ALL BOOKINGS -->
  <div class="card">
    <h2>üìã –í—Å–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
    <button id="listBookingsBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫</button>
    <div id="listBookingsResponse" class="response" style="display:none;"></div>
  </div>

  <!-- EXPORT BOOKINGS CSV -->
  <div class="card">
    <h2>üì• –≠–∫—Å–ø–æ—Ä—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π</h2>
    <a href="http://localhost:8082/api/booking/export-csv" target="_blank">
      <button type="button">‚¨áÔ∏è –°–∫–∞—á–∞—Ç—å bookings.csv</button>
    </a>
  </div>
</div>

<footer>
  <p>–§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è Spring Boot –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ ‚Ä¢ –¢–æ–ª—å–∫–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã</p>
</footer>

<script>
  // === TABS ===
  document.querySelectorAll('.tab').forEach(tab => {
    tab.addEventListener('click', () => {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
      tab.classList.add('active');
      document.getElementById(tab.dataset.tab).classList.add('active');
    });
  });

  // === HELPERS ===
  const showResponse = (elId, text, isError = false) => {
    const el = document.getElementById(elId);
    el.textContent = text;
    el.style.display = 'block';
    el.className = 'response ' + (isError ? 'error' : 'success');
  };

  const postJSON = async (url, data, elId) => {
    try {
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      });
      const json = await res.json();
      showResponse(elId, JSON.stringify(json, null, 2), !res.ok);
    } catch (err) {
      showResponse(elId, `‚ùå –û—à–∏–±–∫–∞: ${err.message}`, true);
    }
  };

  const getJSON = async (url, elId) => {
    try {
      const res = await fetch(url);
      const json = await res.json();
      showResponse(elId, JSON.stringify(json, null, 2), !res.ok);
    } catch (err) {
      showResponse(elId, `‚ùå –û—à–∏–±–∫–∞: ${err.message}`, true);
    }
  };

  // === FLIGHTS ===
  document.getElementById('createForm').addEventListener('submit', e => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const data = Object.fromEntries(fd.entries());
    // convert numbers
    data.passengerCount = parseInt(data.passengerCount);
    data.ticketPrice = parseFloat(data.ticketPrice);
    postJSON('http://localhost:8081/api/flight/create', data, 'createResponse');
  });

  document.getElementById('updateForm').addEventListener('submit', e => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const data = Object.fromEntries(fd.entries());
    data.id = parseInt(data.id);
    data.passengerCount = parseInt(data.passengerCount);
    data.ticketPrice = parseFloat(data.ticketPrice);
    postJSON('http://localhost:8081/api/flight/update', data, 'updateResponse');
  });

  document.getElementById('deleteForm').addEventListener('submit', e => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const id = parseInt(fd.get('id'));
    postJSON('http://localhost:8081/api/flight/delete', { id }, 'deleteResponse');
  });

  document.getElementById('queryForm').addEventListener('submit', e => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const data = Object.fromEntries(fd.entries());
    // remove empty fields
    Object.keys(data).forEach(k => data[k] === '' && delete data[k]);
    postJSON('http://localhost:8081/api/flight/query', data, 'queryResponse');
  });

  document.getElementById('listFlightsBtn').addEventListener('click', () => {
    getJSON('http://localhost:8081/api/flight/all', 'listFlightsResponse');
  });

  document.getElementById('importForm').addEventListener('submit', async e => {
    e.preventDefault();
    const fileInput = document.getElementById('csvFile');
    const file = fileInput.files[0];
    if (!file) return showResponse('importResponse', '‚ùå –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª', true);

    const formData = new FormData();
    formData.append('file', file);

    try {
      const res = await fetch('http://localhost:8081/api/flight/import-csv', {
        method: 'POST',
        body: formData
      });
      const text = await res.text();
      showResponse('importResponse', text, !res.ok);
    } catch (err) {
      showResponse('importResponse', `‚ùå –û—à–∏–±–∫–∞: ${err.message}`, true);
    }
  });

  // === BOOKINGS ===
  document.getElementById('bookingCreateForm').addEventListener('submit', e => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const data = {
      flightId: parseInt(fd.get('flightId')),
      passengerCount: parseInt(fd.get('passengerCount'))
    };
    postJSON('http://localhost:8082/api/booking/create', data, 'bookingCreateResponse');
  });

  document.getElementById('bookingUpdateForm').addEventListener('submit', e => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const data = {
      id: parseInt(fd.get('id')),
      passengerCount: parseInt(fd.get('passengerCount'))
    };
    postJSON('http://localhost:8082/api/booking/update', data, 'bookingUpdateResponse');
  });

  document.getElementById('bookingDeleteForm').addEventListener('submit', e => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const id = parseInt(fd.get('id'));
    postJSON('http://localhost:8082/api/booking/delete', { id }, 'bookingDeleteResponse');
  });

  document.getElementById('listBookingsBtn').addEventListener('click', () => {
    getJSON('http://localhost:8082/api/booking/all', 'listBookingsResponse');
  });
</script>

</body>
</html>
